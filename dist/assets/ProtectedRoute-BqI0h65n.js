import{u as D,r as i,a as h,j as e,N as b,O as g}from"./index-DDFCQUB-.js";function v(s){const o=typeof window<"u"?localStorage.getItem(s):null;return o||((typeof window<"u"?sessionStorage.getItem(s):null)??null)}function m(){try{localStorage.removeItem("token"),localStorage.removeItem("user"),sessionStorage.removeItem("token"),sessionStorage.removeItem("user")}catch{}}function R(){return e.jsxDEV("div",{className:"min-h-screen grid place-items-center p-6",children:e.jsxDEV("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsxDEV("span",{className:"h-4 w-4 border-2 border-emerald-600 border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:63,columnNumber:9},this),e.jsxDEV("span",{children:"Verifying your session..."},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:64,columnNumber:9},this)]},void 0,!0,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:62,columnNumber:7},this)},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:61,columnNumber:5},this)}function j({message:s,onRetry:o}){return e.jsxDEV("div",{className:"min-h-screen grid place-items-center p-6",children:e.jsxDEV("div",{className:"max-w-md w-full space-y-4 text-center",children:[e.jsxDEV("p",{className:"text-gray-700",children:s},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:80,columnNumber:9},this),e.jsxDEV("div",{className:"flex items-center justify-center gap-3",children:[e.jsxDEV("button",{onClick:o,className:"px-4 py-2 rounded-md bg-emerald-600 text-white hover:bg-emerald-700",children:"Retry"},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:82,columnNumber:11},this),e.jsxDEV("a",{href:"/auth/login",className:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Go to Login"},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:88,columnNumber:11},this)]},void 0,!0,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:81,columnNumber:9},this)]},void 0,!0,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:79,columnNumber:7},this)},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:78,columnNumber:5},this)}const k=({allowedRoles:s=["admin"]})=>{const o=D(),[a,n]=i.useState("checking"),[x,l]=i.useState("/auth/login"),f=i.useRef(!1),u=i.useRef(null),p=i.useMemo(()=>{const r=v("token");if(!r)return null;const t=r.trim().toLowerCase();return!r||t===""||t==="null"||t==="undefined"?null:r},[]),c=i.useCallback(async()=>{if(!p){m(),l("/auth/login"),n("redirect");return}try{n("checking");const t=(await h.get("/users/me"))?.data?.data?.user;if(!t)throw new Error("Invalid /users/me response");const N=(t.role||"").toString().toLowerCase();if(!s.map(d=>d.toLowerCase()).includes(N)){m(),l("/auth/login"),n("redirect");return}try{const d=JSON.stringify(t);localStorage.setItem("user",d)}catch{}n("ok")}catch(r){const t=r?.response?.status;if(t===401||t===403){m(),l("/auth/login"),n("redirect");return}if(t===429){u.current="Too many attempts. Please wait a moment and retry.",n("error");return}u.current=r?.response?.data?.message||r?.message||"We couldn't verify your session due to a connection issue.",n("error")}},[p,s]);return i.useEffect(()=>{f.current||(f.current=!0,c())},[c]),a==="checking"?e.jsxDEV(R,{},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:188,columnNumber:12},void 0):a==="redirect"?e.jsxDEV(b,{to:x,replace:!0,state:{from:o.pathname+o.search}},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:194,columnNumber:7},void 0):a==="error"?e.jsxDEV(j,{message:u.current||"Couldn't verify your session.",onRetry:()=>void c()},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:205,columnNumber:7},void 0):e.jsxDEV(g,{},void 0,!1,{fileName:"D:/Desktop/MY projects/Routeflex-Admin-pannel/src/middlewares/ProtectedRoute.tsx",lineNumber:213,columnNumber:10},void 0)};export{k as default};
